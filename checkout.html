<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Cuchitas</title>
    <meta name="description" content="Finaliza tu pedido en Cuchitas.">

    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header simplificado -->
    <header>
        <div class="header-container">
            <a href="/" class="logo">
                <img src="images/logo-cuchitas.svg" alt="Cuchitas" width="180" height="45">
            </a>
            <div style="color: white; display: flex; align-items: center; gap: 10px;">
                <span>üîí</span>
                <span>Pago Seguro</span>
            </div>
        </div>
    </header>

    <!-- Checkout Content -->
    <main class="checkout-page">
        <a href="carrito.html" style="color: var(--verde-oscuro); margin-bottom: 20px; display: inline-block;">
            ‚Üê Volver al carrito
        </a>

        <h1 style="margin-bottom: 30px;">Finalizar Pedido</h1>

        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 40px;">
            <!-- Formulario -->
            <div class="checkout-form">
                <h2 style="margin-bottom: 25px; font-size: 20px;">Datos de Env√≠o</h2>

                <form id="checkout-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombre">Nombre *</label>
                            <input type="text" id="nombre" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="apellidos">Apellidos *</label>
                            <input type="text" id="apellidos" name="apellidos" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="telefono">Tel√©fono *</label>
                            <input type="tel" id="telefono" name="telefono" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="direccion">Direcci√≥n *</label>
                        <input type="text" id="direccion" name="direccion" placeholder="Calle, n√∫mero, piso..." required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cp">C√≥digo Postal *</label>
                            <input type="text" id="cp" name="cp" required>
                        </div>
                        <div class="form-group">
                            <label for="ciudad">Ciudad *</label>
                            <input type="text" id="ciudad" name="ciudad" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="provincia">Provincia *</label>
                        <select id="provincia" name="provincia" required>
                            <option value="">Selecciona provincia</option>
                            <option value="A Coru√±a">A Coru√±a</option>
                            <option value="√Ålava">√Ålava</option>
                            <option value="Albacete">Albacete</option>
                            <option value="Alicante">Alicante</option>
                            <option value="Almer√≠a">Almer√≠a</option>
                            <option value="Asturias">Asturias</option>
                            <option value="√Åvila">√Åvila</option>
                            <option value="Badajoz">Badajoz</option>
                            <option value="Barcelona">Barcelona</option>
                            <option value="Burgos">Burgos</option>
                            <option value="C√°ceres">C√°ceres</option>
                            <option value="C√°diz">C√°diz</option>
                            <option value="Cantabria">Cantabria</option>
                            <option value="Castell√≥n">Castell√≥n</option>
                            <option value="Ciudad Real">Ciudad Real</option>
                            <option value="C√≥rdoba">C√≥rdoba</option>
                            <option value="Cuenca">Cuenca</option>
                            <option value="Girona">Girona</option>
                            <option value="Granada">Granada</option>
                            <option value="Guadalajara">Guadalajara</option>
                            <option value="Guip√∫zcoa">Guip√∫zcoa</option>
                            <option value="Huelva">Huelva</option>
                            <option value="Huesca">Huesca</option>
                            <option value="Ja√©n">Ja√©n</option>
                            <option value="La Rioja">La Rioja</option>
                            <option value="Las Palmas">Las Palmas</option>
                            <option value="Le√≥n">Le√≥n</option>
                            <option value="Lleida">Lleida</option>
                            <option value="Lugo">Lugo</option>
                            <option value="Madrid">Madrid</option>
                            <option value="M√°laga">M√°laga</option>
                            <option value="Murcia">Murcia</option>
                            <option value="Navarra">Navarra</option>
                            <option value="Ourense">Ourense</option>
                            <option value="Palencia">Palencia</option>
                            <option value="Pontevedra">Pontevedra</option>
                            <option value="Salamanca">Salamanca</option>
                            <option value="Santa Cruz de Tenerife">Santa Cruz de Tenerife</option>
                            <option value="Segovia">Segovia</option>
                            <option value="Sevilla">Sevilla</option>
                            <option value="Soria">Soria</option>
                            <option value="Tarragona">Tarragona</option>
                            <option value="Teruel">Teruel</option>
                            <option value="Toledo">Toledo</option>
                            <option value="Valencia">Valencia</option>
                            <option value="Valladolid">Valladolid</option>
                            <option value="Vizcaya">Vizcaya</option>
                            <option value="Zamora">Zamora</option>
                            <option value="Zaragoza">Zaragoza</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notas">Notas del pedido (opcional)</label>
                        <textarea id="notas" name="notas" rows="3" placeholder="Instrucciones de entrega, alergias, etc."></textarea>
                    </div>

                    <h2 style="margin: 30px 0 25px; font-size: 20px;">M√©todo de Pago</h2>

                    <div style="background: var(--gris-claro); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="radio" name="pago" value="transferencia" checked>
                            <span><strong>Transferencia Bancaria</strong> - Recibir√°s los datos por email</span>
                        </label>
                    </div>

                    <div style="background: var(--gris-claro); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="radio" name="pago" value="bizum">
                            <span><strong>Bizum</strong> - Pago instant√°neo desde tu m√≥vil</span>
                        </label>
                    </div>

                    <div style="background: #f0f8ff; padding: 20px; border-radius: 8px; border: 2px solid #4CAF50;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="radio" name="pago" value="whatsapp">
                            <span><strong>üí¨ Confirmar por WhatsApp</strong> - Te contactamos para coordinar pago y env√≠o</span>
                        </label>
                    </div>

                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 30px; justify-content: center;">
                        Confirmar Pedido ‚Üí
                    </button>
                </form>
            </div>

            <!-- Resumen del pedido -->
            <div>
                <div class="cart-summary" style="position: sticky; top: 100px;">
                    <h3>Tu Pedido</h3>

                    <div id="order-items" style="margin-bottom: 20px;">
                        <!-- Items del pedido -->
                    </div>

                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">0,00‚Ç¨</span>
                    </div>
                    <div class="summary-row">
                        <span>Env√≠o</span>
                        <span id="shipping">Calculando...</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="total">0,00‚Ç¨</span>
                    </div>

                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gris-medio);">
                        <p style="font-size: 13px; color: #666;">
                            üîí Tus datos est√°n protegidos<br>
                            üì¶ Env√≠o en 24-48h laborables
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer simplificado -->
    <footer style="margin-top: 60px;">
        <div class="footer-bottom" style="border: none; padding: 30px;">
            ¬© 2026 Cuchitas ¬∑ Saben a M√©xico
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/cart.js"></script>
    <script>
        const SHIPPING_CONFIG = {
            freeThreshold: 20,
            standardPrice: 4.90
        };

        const WHATSAPP_NUMBER = '34652600700';

        function renderOrderSummary() {
            // Redirigir si carrito vac√≠o
            if (window.cart.isEmpty()) {
                window.location.href = 'carrito.html';
                return;
            }

            const itemsEl = document.getElementById('order-items');
            itemsEl.innerHTML = window.cart.items.map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px;">
                    <span>${item.name} √ó ${item.quantity}</span>
                    <span style="font-weight: 600;">${(item.price * item.quantity).toFixed(2)}‚Ç¨</span>
                </div>
            `).join('');

            const subtotal = window.cart.getSubtotal();
            const shipping = window.cart.getShipping(SHIPPING_CONFIG);
            const total = subtotal + shipping;

            document.getElementById('subtotal').textContent = subtotal.toFixed(2) + '‚Ç¨';
            document.getElementById('shipping').textContent = shipping === 0 ? 'GRATIS' : shipping.toFixed(2) + '‚Ç¨';
            document.getElementById('total').textContent = total.toFixed(2) + '‚Ç¨';
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderOrderSummary();

            // Manejar env√≠o del formulario
            document.getElementById('checkout-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
                const paymentMethod = formData.get('pago');

                // Datos del cliente
                const customerInfo = {
                    name: `${data.nombre} ${data.apellidos}`,
                    phone: data.telefono,
                    email: data.email,
                    address: `${data.direccion}, ${data.cp} ${data.ciudad}, ${data.provincia}`
                };

                if (paymentMethod === 'whatsapp') {
                    // Abrir WhatsApp con el pedido
                    window.open(window.cart.getWhatsAppLink(WHATSAPP_NUMBER, customerInfo), '_blank');
                } else {
                    // Para otros m√©todos, mostrar confirmaci√≥n
                    alert('¬°Gracias por tu pedido!\n\nRecibir√°s un email con los detalles para completar el pago por ' +
                          (paymentMethod === 'bizum' ? 'Bizum' : 'Transferencia Bancaria') + '.\n\n' +
                          'Si tienes dudas, cont√°ctanos por WhatsApp.');

                    // Aqu√≠ ir√≠a la integraci√≥n con Supabase o backend para guardar el pedido
                    console.log('Pedido:', {
                        customer: customerInfo,
                        items: window.cart.items,
                        subtotal: window.cart.getSubtotal(),
                        shipping: window.cart.getShipping(SHIPPING_CONFIG),
                        total: window.cart.getTotal(SHIPPING_CONFIG),
                        paymentMethod: paymentMethod,
                        notes: data.notas
                    });
                }

                // Vaciar carrito despu√©s del pedido
                // window.cart.clear();
                // window.location.href = 'gracias.html';
            });
        });
    </script>
</body>
</html>